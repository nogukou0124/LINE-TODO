# 基本設計書

## 1. プロジェクト概要

このプロジェクトは、LINEメッセージングプラットフォームを使用したタスク管理アプリケーションの実装を目的としています。ユーザーはLINEを通じてタスクを管理し、タスク完了の報告やタスク通知を受け取ることができます。バックエンドはAWS Lambdaを用いてPythonで実装し、データはAWS RDSに格納されます。

## 2. 機能要件

### 2.1 タスク完了機能

- **機能説明**: ユーザーがLINEメッセージでタスクの完了を報告できるようにします。
- **フロー**:
  1. ユーザーが「タスク完了: タスク内容」などのメッセージをLINEで送信。
  2. LINE APIがこのメッセージをAWS Lambdaに通知。
  3. Lambda関数がメッセージ内容を解析し、データベースのタスク情報を更新（タスクを完了済みにする）。

### 2.2 タスク通知機能

- **機能説明**: 週に1回、ユーザーにタスクの通知を送信します。また、新しいタスクをデータベースに追加します。
- **フロー**:
  1. AWS Lambdaでスケジュールされたジョブが毎週実行される。
  2. Lambda関数がデータベースから未完了のタスク情報を取得。
  3. LINE APIを通じてユーザーにタスクの通知を送信。
  4. ユーザーが新しいタスクを追加する場合も、LINEメッセージを通じてデータベースに新しいタスクを追加します。

## 3. システム構成

### 3.1 フロントエンド

- **LINEプラットフォーム**:
  - **役割**: ユーザーインターフェースとして機能し、メッセージの送受信を行います。
  - **API**: LINE Messaging APIを使用して、ユーザーとのインタラクションを実現します。

### 3.2 バックエンド

- **AWS Lambda**:
  - **役割**: LINE APIからのイベント通知を受け取り、タスク完了処理や通知処理を実行します。
  - **実装言語**: Python
  - **主要機能**:
    - LINEからのメッセージを受け取る。
    - メッセージを解析し、RDSと連携してデータの操作を行う。
    - 定期的な通知を処理するためのスケジュール機能。

### 3.3 データベース

- **AWS RDS**:
  - **役割**: タスクとユーザー情報を格納し、バックエンドと連携してデータの追加・更新・取得・削除を行います。
  - **データベースエンジン**: PostgreSQL または MySQL（選択に応じて変更可能）

## 4. データベース設計

### 4.1 テーブル設計

- **ユーザーテーブル (Users)**
  - `user_id` (VARCHAR, PRIMARY KEY): ユーザーのID（LINEのユーザーIDなど）
  - `user_name` (VARCHAR): ユーザー名

- **タスクテーブル (Tasks)**
  - `task_id` (INTEGER, PRIMARY KEY): タスクのID
  - `task_content` (VARCHAR): タスクの内容
  - `is_completed` (BOOLEAN): タスクの完了状態
  - `user_id` (VARCHAR, FOREIGN KEY): ユーザーID（Usersテーブルの参照）
  - `created_at` (TIMESTAMP): タスク作成日時
  - `updated_at` (TIMESTAMP): タスク更新日時

## 5. インターフェース仕様

### 5.1 LINE API と Lambda の連携

- **LINE Messaging API**:
  - **Webhook**: LINEプラットフォームがメッセージを受信した際にAWS Lambdaにイベントを送信します。
  - **APIエンドポイント**: AWS LambdaのAPI Gateway URLがWebhook URLとして設定されます。

- **AWS Lambda**:
  - **エンドポイント**: API Gatewayを経由して、LINE APIからのPOSTリクエストを受け取ります。
  - **処理内容**:
    - メッセージの解析
    - データベースへのアクセス（追加・更新・取得・削除）

### 5.2 Lambda のスケジュール設定

- **スケジューラー**: AWS CloudWatch Eventsを使用して、Lambda関数を毎週実行するように設定します。

## 6. セキュリティ

- **LINE API**: APIキーとアクセストークンの管理
- **AWS Lambda**: IAMロールとポリシーを使用してアクセス制御
- **AWS RDS**: セキュリティグループと暗号化を使用してデータ保護

## 7. テスト

- **単体テスト**: 各コンポーネント（LINE API、Lambda関数、RDS）の単体テストを実施します。
- **統合テスト**: LINE APIとLambdaの連携、LambdaとRDSの連携を確認します。
- **システムテスト**: 全体のフローを通して、システムが要件を満たすか確認します。

## 8. デプロイ

- **ステージング環境**: 本番環境へのデプロイ前にステージング環境でのテストを実施します。
- **本番環境**: LINEの設定、AWS Lambda、RDSの本番環境へのデプロイを行います。

## 9. 運用・保守

- **監視**: AWS CloudWatchを使用して、Lambda関数とRDSのパフォーマンスを監視します。
- **メンテナンス**: 定期的なバックアップとアップデートを実施します。
